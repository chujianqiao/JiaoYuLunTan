<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="${ctxPath}/assets/expand/plugins/jquery/jquery-3.2.1.min.js?v=${constants.getReleaseVersion()}"></script>
</head>
<body id="body" style="">
<div style="width: 200px;margin: auto">
    <img id="img1" style="width: 200px;height: 70px;">
    <br>
    <img id="img" src="" style="width: 198px;height: 200px;border: 1px solid gray">
    <br>
    <img id="img2" style="width: 200px;height: 75px;">
</div>

</body>
<script type="text/javascript">
    var Feng = {
        ctxPath: "${ctxPath}",
        version: '${constants.getReleaseVersion()}'
    };
</script>
<script type="text/javascript" src="${ctxPath}/assets/common/libs/layui/layui.js?v=${constants.getReleaseVersion()}"></script>
<script type="text/javascript" src="${ctxPath}/assets/common/js/common.js?v=${constants.getReleaseVersion()}"></script>
<script>
    layui.use(['form', 'admin', 'ax','laydate','upload','formSelects'], function () {
        let $ = layui.jquery;
        let $ax = layui.ax;
        var orderNum;
        $(function () {
            debugger
            let memberId = Feng.getUrlParam("memberId");
            let imgAjax = new $ax(Feng.ctxPath + "/alipay/createOrder?memberId=" + memberId);
            let imgRes = imgAjax.start();
            let photo = imgRes.data.imgBase64Str;
            $("#img").attr('src', src='data:image/jpeg;base64,' + photo);
            $("#img1").attr("src","${ctxPath}/assets/common/images/alipay1.png");
            $("#img2").attr("src","${ctxPath}/assets/common/images/alipay2.png");

            orderNum = imgRes.data.orderNum;
            setInterval(searchOrder,3000);//轮询执行，3000ms一次
        })

        /**
         * 查询订单状态
         */
        function searchOrder(){
            let param = orderNum;
            let ordAjax = new $ax(Feng.ctxPath + "/alipay/searchOrder?orderNum=" + param);
            let imgRes = ordAjax.start();
            let tradeStatus = imgRes.data.tradeStatus;
            if(tradeStatus != undefined && tradeStatus == 'success'){
                let index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                window.parent.location.reload();   //刷新父界面
                parent.layer.close(index);    //关闭弹出层
                Feng.success("支付成功！");
            }
        }

    });

</script>
</html>